{% extends "layout.html" %}

{% block content %}
<div class="container mt-5">
    <h1 class="text-center">Quiz</h1>
    <p class="lead text-center">Answer the following question:</p>
    <div class="row">
        <div class="col-md-8">
            <div class="mb-4">
                <p><strong>What kind of knot is this?</strong></p>
                <p>Insert your hook into the stitch:</p>
                <ul>
                    <li>Grab the yarn from your forefinger and pull it through</li>
                    <li>Bring the yarn over your hook</li>
                    <li>Pull it through both loops on your hook</li>
                </ul>
            </div>
        </div>
        <div class="col-md-4 d-flex flex-column align-items-start justify-content-start">
            <form id="answerForm" action="{{ url_for('submit_quiz', quiz_id=3) }}" method="POST">
                <button type="button" name="knotType" value="Slip Knot" class="btn btn-primary mb-2 answer-button">Slip Knot</button>
                <button type="button" name="knotType" value="Single Crochet" class="btn btn-primary mb-2 answer-button">Single Crochet</button>
                <button type="button" name="knotType" value="Half Double Crochet" class="btn btn-primary mb-2 answer-button">Half Double Crochet</button>
                <button type="button" name="knotType" value="Double Crochet" class="btn btn-primary mb-2 answer-button">Double Crochet</button>
            </form>
        </div>

        <div class="row justify-content-center mt-4">
            <div class="col-md-8 d-flex justify-content-between align-items-center">
                <button class="btn btn-secondary small-button" onclick="location.href='{{ url_for('quiz1') }}'">Previous</button>
                <button id="nextButton" class="btn btn-secondary small-button" onclick="location.href='{{ url_for('quiz3') }}'">Next</button>
            </div>
        </div>

    </div>
</div>
{% endblock %}

<script>
document.addEventListener('DOMContentLoaded', function() {
    const answerButtons = document.querySelectorAll('.answer-button');
    const nextButton = document.getElementById('nextButton');
    const correctAnswer = 'Single Crochet';
    let score = 0;

    answerButtons.forEach(button => {
        button.addEventListener('click', function() {
            // Prevent form submission
            event.preventDefault();

            // Update score if the correct answer is chosen
            const selectedAnswer = button.value;
            if (selectedAnswer === correctAnswer) {
                score++;
            }

            // Change the button color when clicked
            button.style.backgroundColor = 'grey';
            button.style.color = 'white';

            // Disable all buttons after one is clicked
            answerButtons.forEach(btn => {
                btn.disabled = true;
            });

            // Enable the "Next" button
            nextButton.disabled = false;
        });
    });

    // Redirect to the next quiz when the "Next" button is clicked
    nextButton.addEventListener('click', function() {
        // Prevent default form submission behavior
        event.preventDefault();

        // Send an AJAX request to update the score
        fetch('{{ url_for("submit_quiz", quiz_id=3) }}', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ score: score }), // Send the current score
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('Failed to update score');
            }
            // Score updated successfully
            console.log('Score updated');
        })
        .catch(error => {
            console.error('Error updating score:', error);
        });

        // Redirect to the next quiz
        window.location.href = '{{ url_for('quiz3') }}';
    });
});
</script>





